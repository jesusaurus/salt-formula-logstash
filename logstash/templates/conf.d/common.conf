{% set event_version = salt['pillar.get']('logstash:event_version', 0) -%}
{% set tags = salt['pillar.get']('logstash:tags', []) -%}
filter {
  # add any global tags
  {% if tags is defined and tags|length > 0 -%}
  mutate {
    'add_tag' => ['{{ tags | join("', '") }}']
  }
  {% endif -%}

  # Common Post Filters
  grep {
    'drop' => true
    {% if event_version == 0 -%}
    'match' => ['@message', '^$']
    {% else -%}
    'match' => ['message', '^$']
    {% endif -%}
    'negate' => true
  }
}
